---
title: "Pinpoint APM Log Rotate 설정하기"
date: 2024-08-31 14:29:12 +0900
categories:
  - blog
tags:
  - APM
  - Pinpoint
---

# 들어가면서 😄
'로그 파일을 얼마나 오랫동안 보관하는 것이 좋을까?' 에 대한 질문에 명확히 답을 내리기란 쉽지 않다. 과거 데이터를 오래 보관하면 추적에 유용하지만, VM 디스크 용량이 제한적이기 때문에 효율적인 관리가 필요하다.
특히 Pinpoint는 대량의 로그 파일을 생성하므로, 자동 로그 로테이션 설정을 하지 않으면 디스크 용량이 가득 차 시스템 장애가 발생할 수 있다.<br/><br/>

이번 게시글에서는 JAR 파일로 설치한 Pinpoint의 로그 파일 로테이션 설정 방법을 다루려고 한다.<br/>
(이전에는 Crontab으로 관리하고 있었는데.. 관리가 어려울 것 같아, 좀 더 체계적인 방법으로 log.xml 파일을 직접 수정해보겠다.)


# Pinpoint 내 log4j2.xml 내용을 수정해보자 🤔
## Pinpoint의 구성 요소
Pinpoint는 다음의 세 가지 주요 구성 요소로 나뉜다.
- Collector
- Web
- Agent
로그 로테이션 설정 방법은, Agent 기준으로 게시글을 작성하겠다.


## log4j2.xml 경로
```
pinpoint-collector-2.4.2/profiles/local/log4j2.xml
```


## log4j2.xml 파일 수정



### [1] 7-Zip 설치


### [2] log4j2 속성

- IfAccumulatedFileSize
IfAccumulatedFileSize는 Log4j2에서 사용되는 조건 중 하나로, 특정 파일 패턴에 대해 파일의 누적 크기가 지정된 용량(exceeds 속성에 정의된 값)을 초과할 때 특정 작업을 트리거하는 데 사용됩니다. 예를 들어, 위 설정에서는 pinpoint-collector-*-*.log 파일들의 총 크기가 1GB를 초과할 경우, 해당 파일을 삭제하거나 다른 작업을 수행하도록 설정할 수 있습니다.

- IfAccumulatedFileCount
IfAccumulatedFileCount는 Log4j2에서 사용하는 조건으로, 특정 파일 패턴에 맞는 파일들의 총 개수가 지정된 수(exceeds 속성에 정의된 값)를 초과할 때 특정 작업을 트리거하는 데 사용됩니다. 예를 들어, 설정된 파일들의 총 개수가 5개를 초과하면 해당 조건에 따라 파일을 삭제하거나 다른 작업을 수행할 수 있습니다.



# 마치며 🤗
단계 자체는 간단하지만, JAR 파일을 압축 해제하고 설정 파일을 수정하는 작업은 자주 접해보지 않았다. 
이번 작업을 기록해두면 유사한 상황에서 유용하게 활용할 수 있을 것 같아 기록하였고 웹 어플리케이션 개발자로써 인프라 리소스보다 어플리케이션 리소스에 관심이 더욱 가는건 사실이다.
문제가 발생하는 빈도는 낮으나 문제가 발생하면 해결하는데 많은 시간과 노력이 소모되기 때문에 문제가 발생하는 것을 미리 방지하는 것이 훨씬 효율적이라는 생각이 든다.



